<!DOCTYPE html>
<html>
<head>
    <title>注册</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial; max-width: 400px; margin: 50px auto; }
        .container { padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        input { width: 100%; padding: 10px; margin: 10px 0; }
        button { background: #28a745; color: white; padding: 10px; border: none; width: 100%; }
        .error { color: red; background: #ffe6e6; padding: 10px; border-radius: 5px; }
        .success { color: green; background: #e6ffe6; padding: 10px; border-radius: 5px; }
        .link { text-align: center; margin-top: 20px; }
        .password-rules {
            font-size: 12px;
            color: #666;
            margin: 5px 0 15px 0;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>注册</h2>
        <div id="message" class="error" style="display:none;"></div>

        <form id="registerForm">
            <input type="text" id="username" name="username" placeholder="用户名（3-20个字符）" required>
            <input type="password" id="password" name="password" placeholder="密码（至少6个字符）" required>
            <input type="password" id="confirmPassword" placeholder="确认密码" required>

            <div class="password-rules">
                <strong>密码要求：</strong><br>
                • 至少6个字符
            </div>

            <button type="submit">注册</button>
        </form>

        <div class="link">
            <a href="login.html">已有账号？去登录</a>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:5001/api';
        const registerForm = document.getElementById('registerForm');
        const messageDiv = document.getElementById('message');

        function showMessage(text, type = 'error') {
            messageDiv.textContent = text;
            messageDiv.className = type;
            messageDiv.style.display = 'block';

            if (type === 'success') {
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
            }
        }

        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            const confirmPassword = document.getElementById('confirmPassword').value.trim();

            // 前端验证
            if (!username || !password) {
                showMessage('用户名和密码不能为空');
                return;
            }

            if (username.length < 3 || username.length > 20) {
                showMessage('用户名长度需在3-20字符之间');
                return;
            }

            if (password.length < 6) {
                showMessage('密码至少需要6个字符');
                return;
            }

            if (password !== confirmPassword) {
                showMessage('两次输入的密码不一致');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: username,
                        password: password
                    })
                });

                const data = await response.json();

                if (data.status === 'success') {
                    showMessage('注册成功！正在跳转到登录页面...', 'success');
                } else {
                    showMessage(data.message || '注册失败');
                }

            } catch (error) {
                showMessage('网络错误，请检查后端是否运行');
                console.error('注册错误:', error);
            }
        });
    </script>
</body>
</html>
